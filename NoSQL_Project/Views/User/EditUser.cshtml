@using NoSQL_Project.Models.Enums
@model NoSQL_Project.Models.User
@{
	ViewData["Title"] = "Add New User";

}
<h1>Add New User</h1>
@{
	if (TempData["Error"] != null)
	{
		<div class="alert alert-danger">
			@TempData["Error"]
		</div>
	}
	if (TempData["SuccessMessage"] != null)
	{
		<div class="alert alert-success">
			@TempData["SuccessMessage"]
		</div>
	}
	User loggedInUser = new User();
	bool isAdmin = false;
	if (ViewBag.LoggedInUser != null)
	{
		loggedInUser = ViewBag.LoggedInUser;
		isAdmin = loggedInUser.UserType == UserType.Service_employee;
	}
}

<div class="add_User_Form">
	<form id="addUserFrom" class="form-check " method="post" asp-action="EditUser">
		<div class="mb-3 col align-items-center">
			<label class="form-label fw-semibold" for="FirstName">First Name:</label>
			<div class="col-sm-8">
				<input class="form-text form-control" type="hidden" id="FirstName" name="FirstName" value="@Model.FirstName" required />
				<span>@Model.FirstName</span>
			</div>
		</div>
		<div class="mb-3 row align-items-center">
			<label class="form-label fw-semibold" for="LastName">Last Name:</label>
			<div class="col-sm-8">
				<input class="form-text form-control" type="hidden" id="LastName" name="LastName" value="@Model.LastName" required />
				<span>@Model.LastName</span>
			</div>
		</div>
		<div class="mb-3 row align-items-center">
			<label class="form-label fw-semibold" for="Email">Email:</label>
			<div class="col-sm-8">
				@{
					if (isAdmin)
					{
						<input class="form-text form-control" type="email" id="Email" name="EmailAddress" value="@Model.EmailAddress" required />
					}
					else
					{
						<input class="form-text form-control" type="hidden" id="Email" name="EmailAddress" value="@Model.EmailAddress" required />
						<span>@Model.EmailAddress</span>
					}
				}

			</div>
		</div>
		<div class="mb-3 row align-items-center">
			<label class="form-label" for="Phone">Phone:</label>
			<div class="col-sm-8">
				<input class="form-text form-control" type="tel" id="Phone" name="PhoneNumber" value="@Model.PhoneNumber" required />
			</div>
		</div>
		<div class="mb-3 row align-items-center">
			<div class="col-sm-8">
				@{
					if(loggedInUser.Id != Model.Id)
					{
						<input class="form-text form-control" type="hidden" id="Password" name="PasswordHash" value="@Model.PasswordHash" required />
					}
					else
					{
						<label class="form-label" for="Password">Change Password</label>
						<input class="form-text form-control" type="hidden" id="Password" name="PasswordHash" value="@Model.PasswordHash" required />
						<input class="form-text form-control" type="password"  name="newPassword" value="" placeholder="Enter a new password IF NEEDED!!" />
					}
				}
			</div>
		</div>
		<div class="mb-3 row align-items-center">
			<label class="form-label" for="Role">Role:</label>
			@{
				if (isAdmin)
				{
					<select style="color: black;" class="form-select" id="Role" name="UserType" required>
						<option value="@Model.UserType">@Model.UserType</option>
						@{
							UserType[] roles = (UserType[])Enum.GetValues(typeof(UserType));
							foreach (var role in roles)
							{
								if (Model.UserType != role && role != UserType.All_employee)
								{
									<option style="color: black;" value="@role">@role</option>
								}
							}

						}
					</select>
				}
				else
				{
					<input class="form-text form-control" type="hidden" id="Role" name="UserType" value="@Model.UserType" required />
					<span>@Model.UserType</span>
				}
			}

		</div>
		<div class="mb-3 row align-items-center">
			<label class="form-label" for="Location">Location:</label>
			@{
				if (isAdmin)
				{
					<select class="form-select" id="Location" name="locationId" required>
						<option value="@Model.Location.LocationId">@Model.Location.Branch</option>
						@{
							if (ViewBag.Locations != null)
							{
								List<Location> dbLocations = ViewBag.Locations;
								foreach (var location in dbLocations)
								{
									if(Model.Location.Branch != location.Branch)
									{
										<option style="color: black;" value="@location.Id">@location.Branch </option>
									}
								}
							}
						}

					</select>
				}
				else
				{
					<input class="form-text form-control" type="hidden" id="Location" name="locationId" value="@Model.Location.LocationId" required />
					<span>@Model.Location.Branch</span>
				}
			 }
			
		</div>
		

		<div class="d-flex justify-content-end me-5 gap-3">
			<a href="/User/index" class="btn btn-outline-secondary px-4">Cancel</a>
			<button type="submit" class="btn btn-primary px-4">Edit User</button>
		</div>
	</form>
</div>